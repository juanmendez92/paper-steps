<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-styles/color.html">
<link rel="import" href="../paper-styles/typography.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/image-icons.html">

<!--
An element which provides a solution to material design steppers.

Example:

    <paper-step title="Do something"></paper-step>

Example:

    <paper-step optional></paper-step>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="paper-step">
  <style>
    :root {
      --paper-step-primary-color: var(--google-blue-500);
      --paper-step-disabled-color: var(--google-grey-500);
    }

    :host {
      var(--paper-font-common-base);
    }

    :host div.line {
      padding-left: 40px;
    }

    :host div.line span.h-title,
    :host div.line span.line {
      display: block;
      position: absolute;
      background-color: var(--paper-grey-50);
    }

    :host div.line span.h-title {
      margin-top: 11px;
      padding-right: 8px;
      z-index: 2;
    }

    :host div.line span.line {
      border-bottom: 1px solid var(--google-grey-500);
      padding-bottom: 20px;
    }

    :host div.line span.line.last {
      display: none;
    }

    :host .icon {
      width: 24px;
      height: 24px;
    }

    :host .step span {
      width: 24px;
    }

    :host(.iron-selected) .icon {
      color: var(--primary-color, --paper-step-primary-color);
    }

    :host(:not(.iron-selected)) .icon {
      color: var(--disabled-text-color, --paper-step-disabled-color);
    }

    :host .step, :host .step span, :host .step .icon {
      display: inline-block;
      font-size: 12px;
      padding: 4px;
    }

    :host .step span {
      color: var(--paper-grey-50);
      margin: 5px auto;
      position: absolute;
      text-align: center;
      z-index: 2;
    }

    :host .title {

    }

    :host(.iron-selected) .title,
    :host(.iron-selected) div.line span.h-title {
      font-weight: bold;
    }

    :host .icon,
    :host .step,
    :host .title {
      z-index: 1;
      background-color: var(--paper-grey-50);
    }

    :host #content {
      margin-left: 20px;
    }
  </style>
  <template>
    <div class="line" >
      <span class$="h-title {{_cssClass}}">[[title]]</span>
      <span class$="line {{_cssClass}}" style$="{{_lineWidth(steps)}}"></span>
    </div>
    <span class$="step {{_cssClass}}">
      <span>{{step}}</span>
      <iron-icon icon="{{_image}}" class="icon"></iron-icon>
    </span>
    <span hidden$="[[!title]]" class="title">[[title]]</span>
    <div id="content" class$="{{_cssClass}}" >
      <div hidden$="{{!_selected}}">
        <content></content>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      is: "paper-step",
      properties: {
        /**
         * Computed css classes based on the current `step` and the total
         * number value of `steps`.
         */
        _cssClass: {
          type: String,
          computed: '__cssClass(step, steps)'
        },
        /**
         * Computed for the `paper-step` image icon based on the supplied `icon` attribute.
         */
        _image: {
          type: String,
          computed: '_icon(icon, step)'
        },
        /**
         *  Choose an alternate image icon to use for the current step.
         */
        icon: {
          type: String,
          value: 'image:brightness-1'
        },
        /**
         * To indicate if the current step required or optional.
         */
        optional: {
          type: Boolean,
          value: false
        },
        /**
         * The text to display in the steps area next to the image icon.
         */
        title: {
          type: String
        },
        /**
         * Indicates if the current `paper-step` is selected which toggles the
         * actvie/inactive css style rules.
         */
        _selected: {
          type: Boolean,
          value: false
        },
        /**
         * The value for the current `paper-step` in `paper-steps`.
         *
         * `Automatically calculated`.
         */
        step: {
          type: Number
        },
        /**
         * The value for the total number of `paper-step` elements (readonly).
         *
         * `Automatically calculated`.
         */
        steps: {
          type: Number,
          readonly: true
        }
      },
      behaviors: [],
      listeners: {},

      // Element Lifecycle
      ready: function() {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.
      },

      attached: function() {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
        var
          parent = this.parentNode && this.parentNode.indexOf && this.parentNode || null;
        ;

        // @TODO: finish adding fallback for shadowDom, not yet ready.
        if (!Boolean(parent) && this.shadowRoot) {
          try {
            parent = this.parentNode.$.selector;
          } catch (e) {
            parent = null;
          }
        }

        //
        if (!parent || parent.hasOwnProperty('indexOf') || typeof parent.indexOf != 'function') {
          this.step = 1;
          this.steps = 1;
          try {
            console.log('Improperly declared paper-step element, ' +
              'it is missing the parent iterator.');
            // console.log(this, typeof parent.indexOf, typeof parent.items);
          } catch (e) {}
          return;
        }

        if (!Boolean(this.step)) {
          this.step = parent.indexOf(this) + 1;
        }

        if (!Boolean(this.steps)) {
          this.steps = parent.items.length;
        }
      },

      detached: function() {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },

      /**
       * Computes `_cssClass` property.
       * @return {string}.
       */
      __cssClass: function(step, steps) {
        var cls = '';

        if (step === 1) {
          cls += 'first ';
        }
        if (step === steps) {
          cls += 'last ';
        }
        return cls;
      },
      /**
       * Computes `image` property based on step `icon` and current `step`.
       * @return {string}.
       */
      _icon: function(icon, step) {
        return 'image:brightness-1';
      },
      /**
       * Computes css % width of `paper-step` elements based on the total
       * number value  of `steps`.
       * @return {string}. Eg: "width: 24%;"
       */
      _lineWidth: function(steps) {
        try {
          return "width: " +
            Math.floor(parseFloat(98 / (steps + .5))) + "%;"
          ;
        } catch (e) {
          return 'display: none;';
        }
      },
    });
  </script>
</dom-module>
